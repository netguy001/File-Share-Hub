<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Upload - File Sharing Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark shadow">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-cloud-upload"></i> File Share Hub
            </a>
            <div class="navbar-nav ms-auto d-flex flex-row">
                <a class="nav-link me-3" href="{{ url_for('index') }}">
                    <i class="bi bi-house"></i> Home
                </a>
                <a class="nav-link me-3" href="{{ url_for('admin_manage') }}">
                    <i class="bi bi-gear"></i> Manage
                </a>
                <a class="nav-link" href="{{ url_for('dashboard') }}">
                    <i class="bi bi-list-ul"></i> Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient text-white"
                        style="background: linear-gradient(45deg, #ff6b6b, #ffa500);">
                        <h4 class="mb-0">
                            <i class="bi bi-shield-lock"></i> Admin Upload Panel
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <!-- Flash messages -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show"
                            role="alert">
                            <i
                                class="bi bi-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }}"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}

                        <form method="POST" enctype="multipart/form-data" id="uploadForm">
                            <div class="mb-4">
                                <label for="file" class="form-label fw-bold">
                                    <i class="bi bi-file-earmark-plus"></i> Select File to Upload
                                </label>
                                <div class="upload-area border-2 border-dashed border-primary rounded-3 p-4 text-center position-relative"
                                    style="transition: all 0.3s ease;"
                                    onmouseover="this.style.backgroundColor='#f8f9ff'"
                                    onmouseout="this.style.backgroundColor='transparent'">
                                    <input type="file" class="form-control opacity-0 position-absolute w-100 h-100"
                                        id="file" name="file" required style="cursor: pointer;">
                                    <div class="upload-content">
                                        <i class="bi bi-cloud-upload text-primary" style="font-size: 3rem;"></i>
                                        <h5 class="mt-3 text-primary">Drop files here or click to browse</h5>
                                        <p class="text-muted mb-0">Maximum file size: 16MB</p>
                                    </div>
                                </div>
                                <div class="form-text mt-2">
                                    <strong>Allowed formats:</strong> Programming (js, py, html, css, java, cpp, php),
                                    Images (png, jpg, jpeg, gif, webp, svg, bmp), Audio (mp3, wav, flac, aac, ogg),
                                    Video (mp4, avi, mov, webm, mkv), Documents (pdf, doc, docx, xlsx, ppt, txt, md),
                                    Archives (zip, rar, 7z, tar),
                                    rar, mp4, mp3
                                </div>
                            </div>

                            <div class="mb-3" id="filePreview" style="display: none;">
                                <div class="alert alert-info d-flex align-items-center">
                                    <i class="bi bi-file-check me-2"></i>
                                    <div>
                                        <strong>Selected:</strong> <span id="fileName"></span><br>
                                        <small>Size: <span id="fileSize"></span></small>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="progress" style="height: 25px; display: none;" id="progressBar">
                                    <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                        role="progressbar" style="width: 0%">
                                        <span id="progressText">0%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg shadow" id="uploadBtn">
                                    <i class="bi bi-cloud-upload"></i> Upload File
                                </button>
                            </div>
                        </form>

                        <hr class="my-4">

                        <div class="text-center">
                            <h6 class="text-muted">Quick Actions</h6>
                            <a href="{{ url_for('admin_manage') }}" class="btn btn-outline-warning me-2">
                                <i class="bi bi-gear"></i> Manage Files
                            </a>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary me-2">
                                <i class="bi bi-list-ul"></i> View All Files
                            </a>
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-house"></i> Back to Home
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Upload Instructions -->
                <div class="card mt-4">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0"><i class="bi bi-info-circle"></i> Upload Instructions</h6>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>Select a file using the file picker above</li>
                            <li>Ensure your file is under 16MB in size</li>
                            <li>Files with duplicate names will be automatically renamed</li>
                            <li>Once uploaded, files will appear immediately on the dashboard</li>
                            <li>All uploaded files are stored securely and can be downloaded by users</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2025 File Share Hub. Admin Panel.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('uploadForm').addEventListener('submit', function (e) {
            const fileInput = document.getElementById('file');
            const uploadBtn = document.getElementById('uploadBtn');
            const progressBar = document.getElementById('progressBar');
            const progressElement = progressBar.querySelector('.progress-bar');
            const progressText = document.getElementById('progressText');

            if (fileInput.files.length === 0) {
                e.preventDefault();
                alert('Please select a file to upload.');
                return;
            }

            // Show progress bar and update button
            progressBar.style.display = 'block';
            uploadBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Uploading...';
            uploadBtn.disabled = true;

            // Simulate progress (since we can't track actual upload progress easily)
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 30;
                if (progress > 90) progress = 90;

                progressElement.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
            }, 200);

            // Clean up interval when form actually submits
            setTimeout(() => {
                clearInterval(interval);
                progressElement.style.width = '100%';
                progressText.textContent = '100%';
            }, 1000);
        });

        // File size validation and preview
        document.getElementById('file').addEventListener('change', function (e) {
            const file = e.target.files[0];
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');

            if (file) {
                if (file.size > 16 * 1024 * 1024) {
                    alert('File size must be less than 16MB');
                    e.target.value = '';
                    filePreview.style.display = 'none';
                    return;
                }

                // Show file preview
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                filePreview.style.display = 'block';

                // Update upload area
                const uploadContent = document.querySelector('.upload-content');
                uploadContent.innerHTML = `
                    <i class="bi bi-file-check text-success" style="font-size: 3rem;"></i>
                    <h5 class="mt-3 text-success">File Ready to Upload</h5>
                    <p class="text-muted mb-0">${file.name}</p>
                `;
            } else {
                filePreview.style.display = 'none';
                // Reset upload area
                const uploadContent = document.querySelector('.upload-content');
                uploadContent.innerHTML = `
                    <i class="bi bi-cloud-upload text-primary" style="font-size: 3rem;"></i>
                    <h5 class="mt-3 text-primary">Drop files here or click to browse</h5>
                    <p class="text-muted mb-0">Maximum file size: 16MB</p>
                `;
            }
        });

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>

</html>